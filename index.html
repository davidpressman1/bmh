<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BMH | Bais Medrash of Haverstraw</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --accent: #60a5fa;
      --accent-soft: rgba(96, 165, 250, 0.12);
      --card-bg: #020617;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.45);
      --shadow-soft: 0 20px 50px rgba(0, 0, 0, 0.7);
      --radius-xl: 24px;
      --radius-lg: 18px;
      --transition-fast: 160ms ease-out;
      --logo-url: url("https://www.kollect.live/bmh/wp-content/uploads/2024/03/bmh-logo.png");
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        linear-gradient(180deg, rgba(0, 0, 0, 0.85), rgba(15, 23, 42, 0.96)),
        radial-gradient(circle at top left, #0b1120 0, transparent 55%),
        radial-gradient(circle at bottom right, #020617 0, transparent 55%),
        var(--logo-url);
      background-repeat: no-repeat, no-repeat, no-repeat, no-repeat;
      background-size: cover, 120% 120%, 120% 120%, cover;
      background-position: center top, top left, bottom right, center top;
      color: var(--text-main);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      overflow-x: hidden;
    }

    .noise {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.16;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.8'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      z-index: 0;
    }

    /* NAVBAR */

    .nav {
      position: sticky;
      top: 0;
      z-index: 20;
      backdrop-filter: blur(18px);
      background: rgba(0, 0, 0, 0.96);
      border-bottom: 1px solid #111827;
    }

    .nav-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 10px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }

    .brand-mark {
      width: 44px;
      height: 44px;
      border-radius: 999px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #020617;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.9);
      padding: 4px;
      flex-shrink: 0;
    }

    .brand-mark img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .brand-text-main {
      font-weight: 700;
      letter-spacing: 0.05em;
      font-size: 14px;
      text-transform: uppercase;
      color: #f9fafb;
    }

    .brand-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      gap: 10px;
      font-size: 14px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .nav-links a {
      color: #e5e7eb;
      text-decoration: none;
      padding: 7px 20px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-weight: 600;
      transition:
        background-color var(--transition-fast),
        color var(--transition-fast),
        border-color var(--transition-fast),
        transform var(--transition-fast),
        box-shadow var(--transition-fast);
    }

    .nav-links a:hover,
    .nav-links a:focus-visible {
      background: var(--accent);
      color: #020617;
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9), 0 10px 24px rgba(37, 99, 235, 0.75);
      transform: translateY(-1px);
    }

    .nav-links a.active {
      background: var(--accent);
      color: #020617;
      border-color: var(--accent);
    }

    main {
      position: relative;
      z-index: 1;
    }

    /* HERO */

    .hero {
      max-width: 1100px;
      margin: 0 auto;
      padding: 32px 18px 18px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 36px;
      align-items: center;
    }

    @media (max-width: 900px) {
      .hero {
        grid-template-columns: minmax(0, 1fr);
        padding-top: 26px;
        gap: 24px;
      }
    }

    .hero-copy h1 {
      margin: 0 0 12px;
      font-size: clamp(28px, 6vw, 44px);
      letter-spacing: 0.03em;
      color: var(--accent);
    }

    .hero-tagline {
      font-size: 16px;
      color: #e5e7eb;
      max-width: 520px;
    }

    .hero-meta {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .pill {
      padding: 7px 13px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      display: inline-flex;
      align-items: center;
      gap: 7px;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
      max-width: 100%;
      white-space: normal; /* allow wrapping on mobile */
    }

    .pill-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #bbf7d0 0, #22c55e 40%, #14532d 100%);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.85);
      flex-shrink: 0;
    }

    .hero-card {
      border-radius: var(--radius-xl);
      background:
        radial-gradient(circle at top left, rgba(96, 165, 250, 0.25) 0, transparent 55%),
        radial-gradient(circle at bottom right, rgba(14, 165, 233, 0.2) 0, transparent 60%),
        #020617;
      padding: 20px 18px 16px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .hero-card::after {
      content: "";
      position: absolute;
      right: -40px;
      bottom: -40px;
      width: 160px;
      height: 160px;
      background-image: var(--logo-url);
      background-repeat: no-repeat;
      background-size: contain;
      opacity: 0.06;
      pointer-events: none;
    }

    .hero-card-inner {
      position: relative;
      z-index: 1;
    }

    .hero-card-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .hero-card-time {
      font-size: 30px;
      font-weight: 700;
      color: #f9fafb;
      margin-bottom: 6px;
      word-break: break-word;
    }

    .hero-card-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .hero-card-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .hero-mini {
      border-radius: 14px;
      padding: 9px 10px;
      background: #020617;
      border: 1px solid #374151;
      font-size: 12px;
    }

    .hero-mini-label {
      color: var(--text-muted);
      margin-bottom: 2px;
      font-weight: 500;
    }

    .hero-mini-value {
      font-weight: 600;
      color: #f9fafb;
    }

    /* SECTIONS / CARDS */

    .section {
      max-width: 1100px;
      margin: 0 auto;
      padding: 6px 18px 28px;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 15px;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: #e5e7eb;
    }

    .section-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 650px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      background: #020617;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.7);
      position: relative;
      overflow: hidden;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        border-color var(--transition-fast),
        background var(--transition-fast);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(96, 165, 250, 0.18) 0, transparent 45%);
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-fast);
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 50px rgba(15, 23, 42, 0.95);
      border-color: rgba(96, 165, 250, 0.9);
      background: #020617;
    }

    .card:hover::before {
      opacity: 1;
    }

    .card-label {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 6px;
    }

    .card-main {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #f9fafb;
    }

    .card-times {
      font-size: 14px;
      line-height: 1.5;
      color: #e5e7eb;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 8px;
    }

    .chip {
      border-radius: 999px;
      padding: 4px 9px;
      font-size: 11px;
      background: #020617;
      border: 1px solid rgba(55, 65, 81, 0.9);
      color: var(--text-muted);
    }

    .chip-accent {
      border-color: rgba(96, 165, 250, 0.95);
      background: var(--accent-soft);
      color: #e0f2fe;
      font-weight: 500;
    }

    .small-note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .dynamic-time {
      font-weight: 700;
      color: var(--accent);
    }

    footer {
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 18px 26px;
      font-size: 11px;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: space-between;
      border-top: 1px solid #111827;
      margin-top: 12px;
    }

    .footer-right a {
      color: var(--accent);
      text-decoration: none;
    }

    .footer-right a:hover {
      text-decoration: underline;
    }

    /* Extra mobile tweaks */

    @media (max-width: 640px) {
      .nav-inner {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .nav-links {
        width: 100%;
        justify-content: space-between;
      }

      .nav-links a {
        flex: 1 1 auto;
        text-align: center;
        padding: 6px 10px;
        font-size: 13px;
      }

      .hero {
        padding: 22px 14px 14px;
      }

      .section {
        padding: 4px 14px 22px;
      }

      .hero-tagline {
        font-size: 14px;
      }

      .card-main {
        font-size: 15px;
      }

      .card-times {
        font-size: 13px;
      }

      footer {
        padding-inline: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="noise"></div>

  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <div class="brand-mark">
          <img src="https://www.kollect.live/bmh/wp-content/uploads/2024/03/bmh-logo.png"
               alt="BMH logo" />
        </div>
        <div>
          <div class="brand-text-main">Bais Medrash of Haverstraw</div>
          <div class="brand-text-sub">Warm minyanim in the heart of Haverstraw, NY</div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="#schedule" class="active">Schedule</a>
        <a href="#shabbos">Shabbos</a>
        <a href="#info">Info</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-copy">
        <h1>Bais Medrash of Haverstraw</h1>
        <p class="hero-tagline">
          Weekday and Shabbos times adjust automatically weekly.
        </p>
        <div class="hero-meta">
          <div class="pill">
            <span class="pill-dot"></span>
            <span>Today’s weekday Mincha/Maariv:
              <span id="heroWeekdayMincha" class="dynamic-time">Loading…</span>
            </span>
          </div>
          <div class="pill">
            <span>Shabbos Mincha:
              <span id="heroShabbosMincha" class="dynamic-time">Loading…</span>
            </span>
          </div>
          <div class="pill">
            <span>Shabbos Maariv:
              <span id="heroShabbosMaariv" class="dynamic-time">Loading…</span>
            </span>
          </div>
        </div>
      </div>

      <aside class="hero-card" aria-label="This week at a glance">
        <div class="hero-card-inner">
          <div class="hero-card-title">This Week at BMH</div>
          <div class="hero-card-time">
            <span id="heroPrimaryLabel">Weekday Mincha/Maariv</span>
          </div>
          <div class="hero-card-sub">
            Based on the earliest weekday sunset in Mt Ivy, NY for this week.
          </div>

          <div class="hero-card-grid">
            <div class="hero-mini">
              <div class="hero-mini-label">Mincha/Maariv (Sun–Thu)</div>
              <div class="hero-mini-value" id="weekdayMinchaMaariv">Loading…</div>
            </div>
            <div class="hero-mini">
              <div class="hero-mini-label">Regular Maariv (Weeknights)</div>
              <div class="hero-mini-value">
                8:15&nbsp;PM &middot; 9:45&nbsp;PM
              </div>
            </div>
          </div>

          <div class="hero-card-grid" style="margin-top: 10px;">
            <div class="hero-mini">
              <div class="hero-mini-label">Shacharis (Mon–Fri)</div>
              <div class="hero-mini-value">6:25&nbsp;AM</div>
            </div>
            <div class="hero-mini">
              <div class="hero-mini-label">Shacharis (Sun)</div>
              <div class="hero-mini-value">7:00&nbsp;AM &middot; 8:30&nbsp;AM</div>
            </div>
          </div>
        </div>
      </aside>
    </section>

    <section class="section" id="schedule">
      <div class="section-header">
        <div class="section-title">Weekday Schedule</div>
        <div class="section-subtitle">All times local to Mt Ivy, NY (America/New_York)</div>
      </div>

      <div class="grid">
        <article class="card">
          <div class="card-label">Shacharis</div>
          <div class="card-main">Monday &ndash; Friday</div>
          <div class="card-times">
            Shacharis: <strong>6:25&nbsp;AM</strong>
          </div>
          <div class="chip-row">
            <span class="chip">Vasikin-friendly start</span>
          </div>
        </article>

        <article class="card">
          <div class="card-label">Shacharis</div>
          <div class="card-main">Sunday</div>
          <div class="card-times">
            Early minyan: <strong>7:00&nbsp;AM</strong><br />
            Second minyan: <strong>8:30&nbsp;AM</strong>
          </div>
          <div class="chip-row">
            <span class="chip">Two Sunday options</span>
          </div>
        </article>

        <article class="card">
          <div class="card-label">Mincha &amp; Maariv</div>
          <div class="card-main">Sun &ndash; Thu</div>
          <div class="card-times">
            Mincha/Maariv: <span id="weekdayMinchaMaarivCard" class="dynamic-time">Loading…</span><br />
            <span class="small-note">15 minutes before the earliest weekday shkiya (Mon–Fri) of this week.</span>
          </div>
          <div class="chip-row">
            <span class="chip chip-accent">Auto-adjusts with sunset</span>
          </div>
        </article>

        <article class="card">
          <div class="card-label">Regular Maariv</div>
          <div class="card-main">Weeknights</div>
          <div class="card-times">
            First Maariv: <strong>8:15&nbsp;PM</strong><br />
            Second Maariv: <strong>9:45&nbsp;PM</strong>
          </div>
          <div class="chip-row">
            <span class="chip">All week long</span>
          </div>
        </article>
      </div>
    </section>

    <section class="section" id="shabbos">
      <div class="section-header">
        <div class="section-title">Shabbos Schedule</div>
        <div class="section-subtitle">Shabbos times update weekly from sunset in Mt Ivy</div>
      </div>

      <div class="grid">
        <article class="card">
          <div class="card-label">Shacharis</div>
          <div class="card-main">Shabbos Morning</div>
          <div class="card-times">
            Shacharis: <strong>9:00&nbsp;AM</strong>
          </div>
          <div class="chip-row">
            <span class="chip">Shabbos day minyan</span>
          </div>
        </article>

        <article class="card">
          <div class="card-label">Mincha</div>
          <div class="card-main">Erev/Daytime Shabbos</div>
          <div class="card-times">
            Mincha: <span id="shabbosMinchaTime" class="dynamic-time">Loading…</span><br />
            <span class="small-note">45 minutes before Shabbos sunset.</span>
          </div>
        </article>

        <article class="card">
          <div class="card-label">Maariv</div>
          <div class="card-main">Motzaei Shabbos</div>
          <div class="card-times">
            Maariv: <span id="shabbosMaarivTime" class="dynamic-time">Loading…</span><br />
            <span class="small-note">50 minutes after Shabbos sunset.</span>
          </div>
        </article>
      </div>
    </section>

    <section class="section" id="info">
      <div class="section-header">
        <div class="section-title">Kehilla Info</div>
        <div class="section-subtitle">Bais Medrash of Haverstraw &middot; Mt Ivy, NY</div>
      </div>

      <div class="grid">
        <article class="card">
          <div class="card-label">Location</div>
          <div class="card-main">Mt Ivy, New York</div>
          <div class="card-times">
            All zmanim are calculated using precise coordinates near Mt Ivy, NY and the America/New_York time zone.
          </div>
          <div class="small-note">
            Times are approximate halachic guidance; always follow your Rav for psak.
          </div>
        </article>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-left">
      &copy; <span id="year"></span> Bais Medrash of Haverstraw (BMH). All rights reserved.
    </div>
    <div class="footer-right">
      Sunset calculations based on the NOAA solar formula and local calibration.
    </div>
  </footer>

<script>
  // Exact coordinates for BMH – Mt Ivy, NY
  const LAT = 41.19392515448243;
  const LNG = -74.02504208449552;
  const ZENITH_DEG = 90.0;

  const CALIBRATION_ENABLED = true;
  const REFERENCE_SHABBOS = "2025-12-06";
  const REFERENCE_MOTZAEI_MAARIV = "17:17";
  const REFERENCE_MAARIV_OFFSET_MIN = 50;

  let CAL_OFFSET_MS = 0;

  function toDateParts(date) {
    const d = new Date(date);
    return {
      year: d.getFullYear(),
      month: d.getMonth(),
      day: d.getDate()
    };
  }

  function dayOfYear(date) {
    const d = new Date(date);
    const start = new Date(d.getFullYear(), 0, 0);
    const diff = d - start;
    const oneDay = 1000 * 60 * 60 * 24;
    return Math.floor(diff / oneDay);
  }

  function noaaSunsetUT(date, latDeg, lngDeg, zenithDeg) {
    const N = dayOfYear(date);
    const lngHour = lngDeg / 15.0;

    const t = N + ((18 - lngHour) / 24.0);

    const M = (0.9856 * t) - 3.289;

    const sin = x => Math.sin(x * Math.PI / 180);
    const cos = x => Math.cos(x * Math.PI / 180);
    const tan = x => Math.tan(x * Math.PI / 180);

    let L = M + (1.916 * sin(M)) + (0.020 * sin(2 * M)) + 282.634;
    L = ((L % 360) + 360) % 360;

    let RA = Math.atan(0.91764 * tan(L)) * 180 / Math.PI;
    RA = ((RA % 360) + 360) % 360;

    const Lquadrant = Math.floor(L / 90) * 90;
    const RAquadrant = Math.floor(RA / 90) * 90;
    RA = RA + (Lquadrant - RAquadrant);
    RA /= 15.0;

    const sinDec = 0.39782 * sin(L);
    const cosDec = Math.cos(Math.asin(sinDec));

    const cosH = (cos(zenithDeg) - (sinDec * sin(LAT))) / (cosDec * cos(LAT));

    if (cosH < -1 || cosH > 1) {
      return null;
    }

    let H = Math.acos(cosH) * 180 / Math.PI;
    H = H / 15.0;

    const T = H + RA - (0.06571 * t) - 6.622;

    let UT = T - lngHour;
    UT = ((UT % 24) + 24) % 24;
    return UT;
  }

  function getNoaaSunsetDateRaw(date, latDeg, lngDeg, zenithDeg) {
    const { year, month, day } = toDateParts(date);
    const utHours = noaaSunsetUT(new Date(year, month, day), latDeg, lngDeg, zenithDeg);
    if (utHours == null) return null;

    const hours = Math.floor(utHours);
    const minutes = Math.round((utHours - hours) * 60);

    const baseUTC = Date.UTC(year, month, day, 0, 0, 0);
    const sunsetUTC = new Date(baseUTC + (hours * 60 + minutes) * 60 * 1000);
    return sunsetUTC;
  }

  function getSunsetWithCalibration(date) {
    const raw = getNoaaSunsetDateRaw(date, LAT, LNG, ZENITH_DEG);
    if (!raw) return null;
    if (!CALIBRATION_ENABLED || !CAL_OFFSET_MS) return raw;
    return new Date(raw.getTime() + CAL_OFFSET_MS);
  }

  function formatTimeLocal(date) {
    return date.toLocaleTimeString("en-US", {
      hour: "numeric",
      minute: "2-digit"
    });
  }

  function getMondayOfWeek(date) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = (day === 0 ? -6 : 1) - day;
    d.setDate(d.getDate() + diff);
    d.setHours(12, 0, 0, 0);
    return d;
  }

  function getComingShabbos(fromDate) {
    const d = new Date(fromDate);
    let day = d.getDay();
    let diff = (6 - day + 7) % 7;
    if (diff === 0 && d.getHours() >= 18) {
      diff = 7;
    }
    d.setDate(d.getDate() + diff);
    d.setHours(12, 0, 0, 0);
    return d;
  }

  function parseLocalTimeOnDate(dateString, timeStr) {
    const [h, m] = timeStr.split(":").map(Number);
    const d = new Date(dateString + "T00:00:00");
    d.setHours(h, m, 0, 0);
    return d;
  }

  function computeCalibrationOffsetMs() {
    if (!CALIBRATION_ENABLED) return 0;

    const shabbosDate = new Date(REFERENCE_SHABBOS + "T12:00:00");
    const computedSunset = getNoaaSunsetDateRaw(shabbosDate, LAT, LNG, ZENITH_DEG);
    if (!computedSunset) return 0;

    const maarivActual = parseLocalTimeOnDate(REFERENCE_SHABBOS, REFERENCE_MOTZAEI_MAARIV);
    const shkiyahActual = new Date(maarivActual.getTime() - REFERENCE_MAARIV_OFFSET_MIN * 60 * 1000);

    const offsetMs = shkiyahActual.getTime() - computedSunset.getTime();
    return offsetMs;
  }

  async function updateWeekdayMinchaMaariv() {
    const today = new Date();
    const monday = getMondayOfWeek(today);
    const sunsets = [];

    for (let i = 0; i < 5; i++) {
      const d = new Date(monday);
      d.setDate(monday.getDate() + i);
      const sunset = getSunsetWithCalibration(d);
      if (sunset) sunsets.push(sunset);
    }

    try {
      if (!sunsets.length) throw new Error("No sunsets computed");

      let earliest = sunsets[0];
      for (const s of sunsets) {
        if (s.getTime() < earliest.getTime()) earliest = s;
      }

      const minchaTime = new Date(earliest.getTime() - 15 * 60 * 1000);
      const timeStr = formatTimeLocal(minchaTime);

      const elMain = document.getElementById("weekdayMinchaMaariv");
      const elCard = document.getElementById("weekdayMinchaMaarivCard");
      const elHero = document.getElementById("heroWeekdayMincha");

      if (elMain) elMain.textContent = timeStr;
      if (elCard) elCard.textContent = timeStr;
      if (elHero) elHero.textContent = timeStr;
    } catch (e) {
      console.error(e);
      const fallback = "Check shul board";
      ["weekdayMinchaMaariv", "weekdayMinchaMaarivCard", "heroWeekdayMincha"]
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = fallback;
        });
    }
  }

  async function updateShabbosTimes() {
    const today = new Date();
    const shabbos = getComingShabbos(today);

    try {
      const sunset = getSunsetWithCalibration(shabbos);
      if (!sunset) throw new Error("No Shabbos sunset");

      const mincha = new Date(sunset.getTime() - 45 * 60 * 1000);
      const maariv = new Date(sunset.getTime() + 50 * 60 * 1000);

      const minchaStr = formatTimeLocal(mincha);
      const maarivStr = formatTimeLocal(maariv);

      const shMincha = document.getElementById("shabbosMinchaTime");
      const shMaariv = document.getElementById("shabbosMaarivTime");
      const heroMincha = document.getElementById("heroShabbosMincha");
      const heroMaariv = document.getElementById("heroShabbosMaariv");

      if (shMincha) shMincha.textContent = minchaStr;
      if (shMaariv) shMaariv.textContent = maarivStr;
      if (heroMincha) heroMincha.textContent = minchaStr;
      if (heroMaariv) heroMaariv.textContent = maarivStr;
    } catch (e) {
      console.error(e);
      const fallback = "See local listing";
      ["shabbosMinchaTime", "shabbosMaarivTime", "heroShabbosMincha", "heroShabbosMaariv"]
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = fallback;
        });
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const yearEl = document.getElementById("year");
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    CAL_OFFSET_MS = computeCalibrationOffsetMs();
    updateWeekdayMinchaMaariv();
    updateShabbosTimes();
  });
</script>
</body>
</html>
